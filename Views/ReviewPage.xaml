<Page
    x:Class="TimeLapseCam.Views.ReviewPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:TimeLapseCam.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:TimeLapseCam.ViewModels"
    xmlns:services="using:TimeLapseCam.Services"
    mc:Ignorable="d">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="250" />
        </Grid.ColumnDefinitions>

        <!-- Recordings List -->
        <Grid Grid.Column="0" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="0,0,1,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <TextBlock Text="Recordings" Style="{StaticResource SubtitleTextBlockStyle}" Margin="10"/>
            
            <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.Recordings, Mode=OneWay}"
                      SelectedItem="{x:Bind ViewModel.SelectedRecording, Mode=TwoWay}"
                      Padding="10">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="vm:RecordingFile">
                        <StackPanel Margin="0,5">
                            <TextBlock Text="{x:Bind Name}" FontWeight="Bold"/>
                            <TextBlock Text="{x:Bind CreationTime}" FontSize="11" Foreground="Gray"/>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>

        <!-- Player -->
        <MediaPlayerElement x:Name="Player" Grid.Column="1" 
                            Source="{x:Bind ViewModel.PlaybackSource, Mode=OneWay}"
                            AutoPlay="True" AreTransportControlsEnabled="True"/>

        <!-- Events List -->
        <Grid Grid.Column="2" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="1,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <StackPanel Margin="10" Spacing="8">
                <TextBlock Text="Events" Style="{StaticResource SubtitleTextBlockStyle}"/>
                <Button Content="ðŸ” Detect Objects" 
                        Command="{x:Bind ViewModel.AnalyzeCommand}"
                        HorizontalAlignment="Stretch"/>
                <TextBlock Text="{x:Bind ViewModel.AnalysisStatus, Mode=OneWay}" 
                           FontSize="12" Foreground="Gray" TextWrapping="Wrap"/>
            </StackPanel>
            
            <ListView Grid.Row="2" ItemsSource="{x:Bind ViewModel.Events, Mode=OneWay}"
                      SelectedItem="{x:Bind ViewModel.SelectedEvent, Mode=TwoWay}"
                      Padding="10">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="services:EventItem">
                        <StackPanel Margin="0,5">
                            <TextBlock Text="{x:Bind Type}" FontWeight="Bold" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                            <TextBlock Text="{x:Bind Description}" TextWrapping="Wrap"/>
                            <TextBlock Text="{x:Bind Timestamp}" Foreground="Gray" FontSize="11"/>
                        </StackPanel>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>
    </Grid>
</Page>
